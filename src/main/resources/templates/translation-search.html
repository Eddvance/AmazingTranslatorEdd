<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8"/>
    <title>Recherche</title>
    <!-- Lien vers la feuille de style (à adapter selon ton projet) -->
    <link rel="stylesheet" href="/css/translation-search.css">
</head>
<body>
<h1>Rechercher une traduction</h1>

<!--
    Formulaire utilisant un champ texte.
    On ne restreint pas la saisie côté client :
    si l’utilisateur saisit par ex. '50', c’est le serveur qui renverra une erreur.
-->
<form id="searchForm">
    <label for="numberInput">Numéro :</label>
    <input
            type="text"
            id="numberInput"
            name="number"
            required
            placeholder="Entrez un nombre à traduire"
    />
    <button type="submit">Rechercher</button>
</form>

<!--
    Conteneur où l’on affichera soit le résultat (en cas de succès),
    soit un message d’erreur (en cas de numéro invalide ou hors bornes).
-->
<div id="resultContainer"></div>

<script>
    // Au submit, on empêche l’envoi classique du formulaire,
    // puis on fait un appel AJAX (fetch) vers le serveur.
    document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const numberValue = document.getElementById('numberInput').value.trim();
        const resultDiv = document.getElementById('resultContainer');

        // On peut vider d’abord le conteneur en cas de nouvelle recherche
        resultDiv.innerHTML = '';

        // Requête GET asynchrone vers /translations/search/html/{number}
        fetch('/translations/search/html/' + numberValue)
            .then(response => {
                if (!response.ok) {
                    // En cas d’erreur (404, 400, etc.), on récupère le texte retourné
                    return response.text().then(errorText => {
                        // Affichage d’un message d’erreur dans la même zone
                        resultDiv.innerHTML = '<p style="color:red;">Erreur : '
                            + errorText + '</p>';
                        // Pour stopper le .then principal, on lance une exception
                        throw new Error('HTTP error ' + response.status);
                    });
                }
                // Sinon, on lit la réponse en texte
                return response.text();
            })
            .then(resultHtml => {
                // Cas succès : le serveur peut renvoyer du HTML
                // (exemple : le snippet Thymeleaf 'translation-result')
                // qu’on injecte dans le conteneur
                resultDiv.innerHTML = resultHtml;
            })
            .catch(err => {
                // Pour le debug : log de l’erreur en console
                console.error(err);
            });
    });
</script>

</body>
</html>