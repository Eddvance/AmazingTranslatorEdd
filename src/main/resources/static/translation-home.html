<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Traductions : liste + choix de langue</title>
    <link rel="stylesheet" href="translation-home.css">
</head>
<body>
<h1>Traductions : liste complète et recherche par langue</h1>

<!-- Bouton pour la liste complète -->
<button type="button" id="btnList">Afficher la liste complète</button>

<!-- Tableau pour la liste complète -->
<table id="translationTable">
    <thead>
    <tr>
        <th>Numéro</th>
        <th>Français</th>
        <th>Allemand</th>
    </tr>
    </thead>
    <tbody id="translationTableBody">
    <!-- Contenu généré dynamiquement -->
    </tbody>
</table>

<hr>

<h2>Recherche par numéro + langue</h2>
<form id="searchForm">
    <label for="searchNumber">Numéro :</label>
    <input type="number" id="searchNumber" min="1" required />

    <label for="langSelect">Langue :</label>
    <select id="langSelect">
        <option value="fr">Français</option>
        <option value="de">Allemand</option>
    </select>

    <button type="submit">Chercher</button>
</form>

<!-- Zone d'affichage de la traduction recherchée -->
<div id="selectedTranslation"></div>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const btnList = document.getElementById('btnList');
        const translationTableBody = document.getElementById('translationTableBody');

        const searchForm = document.getElementById('searchForm');
        const searchNumberInput = document.getElementById('searchNumber');
        const langSelect = document.getElementById('langSelect');
        const selectedTranslationDiv = document.getElementById('selectedTranslation');

        // 1) Afficher la liste complète (fr+de)
        btnList.addEventListener('click', () => {
            fetch("/translations/api/translations/list")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erreur HTTP: " + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    // On vide le tableau
                    translationTableBody.innerHTML = '';

                    data.forEach(item => {
                        const tr = document.createElement('tr');

                        // Numéro
                        const tdNumber = document.createElement('td');
                        tdNumber.textContent = item.number;
                        tr.appendChild(tdNumber);

                        // Français
                        const tdFrench = document.createElement('td');
                        tdFrench.textContent = item.french ?? 'N/A';
                        tr.appendChild(tdFrench);

                        // Allemand
                        const tdGerman = document.createElement('td');
                        tdGerman.textContent = item.german ?? 'N/A';
                        tr.appendChild(tdGerman);

                        translationTableBody.appendChild(tr);
                    });
                })
                .catch(error => {
                    translationTableBody.innerHTML = '';
                    const tr = document.createElement('tr');
                    const tdError = document.createElement('td');
                    tdError.colSpan = 3;
                    tdError.style.color = 'red';
                    tdError.textContent = error.message;
                    tr.appendChild(tdError);
                    translationTableBody.appendChild(tr);
                });
        });

        // 2) Recherche par numéro + langue choisie (fr ou de)
        searchForm.addEventListener('submit', (event) => {
            event.preventDefault();

            const numberToSearch = searchNumberInput.value;
            const selectedLang = langSelect.value;

            // On appelle l’URL existante "/search/{number}" (déjà définie sur le serveur)
            const url = `/translations/api/translations/search/${numberToSearch}`;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Aucune traduction trouvée ou erreur HTTP: " + response.status);
                    }
                    // On récupère l'objet JSON complet
                    return response.json();
                })
                .then(data => {
                    // On choisit le champ à afficher selon la langue sélectionnée
                    let translationText;
                    if (selectedLang === 'fr') {
                        translationText = data.french;
                    } else {
                        translationText = data.german;
                    }

                    // Affichage
                    selectedTranslationDiv.innerHTML = '';
                    const p = document.createElement('p');
                    p.textContent = `Traduction (${selectedLang}) : ${translationText}`;
                    selectedTranslationDiv.appendChild(p);
                })
                .catch(error => {
                    selectedTranslationDiv.innerHTML = `<p style="color:red;">${error.message}</p>`;
                });
        });
    });
</script>
</body>
</html>